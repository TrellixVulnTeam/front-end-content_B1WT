# CDN

CDN（Content Delivery Network），内容分发网络
CDN 是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。
CDN 的关键技术主要有内容存储和分发技术
**CDN 原理是将数据放在尽可能离用户近的地方**

## CDN 优势

CDN 就类似于京东的仓储系统，在京东上买自营产品的话，它会根据我们的收货地点，在全国范围内找离最近、送达最快的仓库，不管我们在哪，我们的收货时间都会大大减少

1. CDN 节点解决了跨运营商和跨地域访问的问题，访问延时大大降低；
2. 大部分请求在 CDN 边缘节点完成，CDN 起到了分流作用，减轻了源站的负载。

CDN 是静态资源提速的重要手段，每个网站的静态资源都是从 CDN 服务器上请求来的
静态资源本身具有访问频率高、承接流量大的特点，因此静态资源加载速度始终是前端性能的一个非常关键的指标（访问速度快是电商网站取胜的必要法宝之一）

## CDN 核心

CDN 的核心点有两个，一个是缓存，一个是回源

- 缓存：就是把资源备份到 CDN 服务器上这个过程
- 回源：CDN 发现自己没有这个资源（或者缓存的数据过期了），转头向源服务器（或者它的上层服务器）去要这个资源的过程

**CDN 用来存放静态资源**
根服务器本质上是业务服务器，它的核心任务在于生成并返回动态资源，这种过程需要计算
静态资源：JS、CSS、img等不需要业务服务器进行计算即得的资源
动态资源：需要后端实时动态生成的资源，较为常见的就是 JSP、ASP等

## CDN 如何保证资源的更新和同步

1. 主动刷新来清除缓存，后续的访问会回源，拉取最新资源
2. 设置 CDN 缓存时不忽略参数，若想访问最新资源可通过来请求后面带上不同的参数，这样 CDN 就会回源，拉取最新资源

## CDN 原理

当用户请求路径时，DNS 服务器会将域名的解析权交给 CName 指向的 CDN 专用 DNS 服务器
专用 DNS 服务器返回 CDN 负载均衡服务器的 IP 地址
负载均衡服务器根据设置好的策略以及用户的网络地址来选择合适的 CDN 缓存服务器，并返回 IP 地址
最后客户端对该缓存服务器发起请求，缓存服务器响应请求并返回相应内容
如果这台缓存服务器没有命中，那么它会继续请求它上一级的缓存服务器，直到追溯到源服务器，将内容拉到本地

## CDN 优化

上淘宝时，我们注意到根服务器域名为：www.taobao.com
而淘宝部署的 CDN 服务器域名为：g.alicdn.com

同一个域名下的所有请求都会携带 Cookie(就算是请求一个 img 或 CSS)，而静态资源往往并不需要 Cookie 携带什么认证信息
所以把静态资源和主页面置于不同的域名下，完美地避免了不必要的 Cookie 携带
