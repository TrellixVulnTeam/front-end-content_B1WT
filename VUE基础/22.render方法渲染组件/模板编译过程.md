# 模板编译过程

编译过程分为三个阶段：

1. 将模板字符串解析为 AST
解析器(parse)会将模板字符串截取成一小段一小段，然后维护一个 stack 用来保存 DOM 深度，每截取到一段标签的开始就 push 到 stack 中
通过各种正则表达式匹配模板的内容，然后将内容提取出来做各种逻辑操作，当整个字符串都截取完后就解析出了一个完整的 AST
2. 优化 AST
优化器(optimizer)会用递归的方式将所有节点打标记，表示是否是一个静态节点，然后再次递归一遍把静态根节点也标记出来
将静态节点提取出来，跳过 diff 算法
3. 将 AST 转换为 render 函数
代码生成器(code generator)也会通过递归去拼一个函数执行代码的字符串，递归的过程根据不同的节点类型调用不同的生成方法
如果发现是一个元素节点就拼一个生成节点的函数调用字符串，然后 data 和 children 也是使用 AST 中的属性去拼字符串
如果 children 中还有 children 就又会递归去拼字符串，最后就拼出一个完整的 render 函数代码
4. render 函数会生成虚拟节点 vnode，vnode 的集合组成 Virtual Dom，最后生成真实Dom
